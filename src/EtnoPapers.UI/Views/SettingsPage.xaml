<Page x:Class="EtnoPapers.UI.Views.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="White"
      Foreground="Black">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="40">
            <!-- Header -->
            <StackPanel Margin="0,0,0,24">
                <TextBlock Text="Configurações" FontSize="28" FontWeight="Bold" Foreground="#0078D4" Margin="0,0,0,8"/>
                <TextBlock Text="Configure a integração com OLLAMA, MongoDB e preferências da aplicação" FontSize="14" Foreground="#505050" TextWrapping="Wrap"/>
            </StackPanel>

            <!-- OLLAMA Settings -->
            <Border Background="#F3F3F3" Padding="20" CornerRadius="8" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Configuração OLLAMA" FontSize="18" FontWeight="Bold" Margin="0,0,0,16"/>

                    <TextBlock Text="URL do OLLAMA" FontSize="12" Foreground="#505050" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding OllamaUrl, UpdateSourceTrigger=PropertyChanged}" Padding="8,6" Margin="0,0,0,12" Background="White" BorderBrush="#E0E0E0"/>

                    <TextBlock Text="Modelo OLLAMA" FontSize="12" Foreground="#505050" Margin="0,0,0,4"/>
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0" ItemsSource="{Binding AvailableModels}" SelectedItem="{Binding OllamaModel, UpdateSourceTrigger=PropertyChanged}" Padding="8,6" Background="White" BorderBrush="#E0E0E0"/>
                        <Button Grid.Column="1" Content="Atualizar" Margin="8,0,0,0" Padding="12,6" Background="#0078D4" Foreground="White" Command="{Binding TestOllamaCommand}"/>
                    </Grid>

                    <TextBlock Text="ℹ Deixe em branco ou selecione 'Autodetectar' para usar o melhor modelo disponível" FontSize="11" Foreground="#8A8A8A" Margin="0,0,0,12"/>

                    <TextBlock Text="Prompt Personalizado (Deixe em branco para usar prompt padrão)" FontSize="12" Foreground="#505050" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding OllamaPrompt, UpdateSourceTrigger=PropertyChanged}" Height="300" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" AcceptsReturn="True" Padding="10,8" Margin="0,0,0,12" Background="White" BorderBrush="#CCCCCC" FontFamily="Courier New" FontSize="11"/>

                    <TextBlock Text="ℹ Dica: Cole um prompt completo (ex: instrução de como extrair dados etnobotânicos)" FontSize="10" Foreground="#8A8A8A" Margin="0,-8,0,12" FontStyle="Italic"/>

                    <Button Content="Testar Conexão" Command="{Binding TestOllamaCommand}" Padding="16,8" Background="#0078D4" Foreground="White" Margin="0,0,0,12"/>

                    <TextBlock Text="{Binding OllamaTestStatus}" FontSize="12" Foreground="#505050" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- MongoDB Settings -->
            <Border Background="#F3F3F3" Padding="20" CornerRadius="8" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Configuração MongoDB" FontSize="18" FontWeight="Bold" Margin="0,0,0,16"/>

                    <TextBlock Text="URI de Conexão" FontSize="12" Foreground="#505050" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding MongodbUri, UpdateSourceTrigger=PropertyChanged}" Padding="8,6" Margin="0,0,0,12" Background="White" BorderBrush="#E0E0E0"/>

                    <TextBlock Text="(Deixe em branco para desabilitar sincronização remota)" FontSize="11" Foreground="#8A8A8A" Margin="0,0,0,12"/>

                    <Button Content="Testar Conexão" Command="{Binding TestMongodbCommand}" Padding="16,8" Background="#0078D4" Foreground="White" Margin="0,0,0,12"/>

                    <TextBlock Text="{Binding MongodbTestStatus}" FontSize="12" Foreground="#505050" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Application Preferences -->
            <Border Background="#F3F3F3" Padding="20" CornerRadius="8" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Preferências da Aplicação" FontSize="18" FontWeight="Bold" Margin="0,0,0,16"/>

                    <CheckBox Content="Verificar atualizações automaticamente" Margin="0,0,0,12" IsChecked="True"/>
                    <CheckBox Content="Mostrar notificações de sincronização" Margin="0,0,0,12" IsChecked="True"/>
                    <CheckBox Content="Lembrar senha do MongoDB" Margin="0,0,0,20" IsChecked="False"/>

                    <Button Content="Salvar Configurações" Command="{Binding SaveSettingsCommand}" Padding="16,8" Background="#0078D4" Foreground="White"/>
                </StackPanel>
            </Border>

            <!-- Success/Error Messages -->
            <Border Background="#E8F5E9" Padding="16" CornerRadius="4" Margin="0,0,0,0" Visibility="{Binding SuccessMessage, Converter={StaticResource StringToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="✓" FontSize="16" Foreground="#4CAF50" FontWeight="Bold" Margin="0,0,12,0"/>
                    <TextBlock Text="{Binding SuccessMessage}" FontSize="13" Foreground="#2E7D32" VerticalAlignment="Center"/>
                </StackPanel>
            </Border>

            <Border Background="#FFEBEE" Padding="16" CornerRadius="4" Margin="0,8,0,0" Visibility="{Binding HasError, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="✗" FontSize="16" Foreground="#F44336" FontWeight="Bold" Margin="0,0,12,0"/>
                    <TextBlock Text="{Binding ErrorMessage}" FontSize="13" Foreground="#C62828" VerticalAlignment="Center" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>

</Page>
